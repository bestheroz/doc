# Redis Stream 메시지 처리 시 장애 대응 방법

1. 메시지 승인(ACK) 및 Pending Entries List 관리

   - XACK 명령어를 사용하여 소비자가 메시지를 성공적으로 처리했음을 Redis에 알립니다. 이를 통해 메시지가 다시 처리되지 않도록 합니다.
   - 메시지 처리가 완료되지 않은 경우, 해당 메시지는 **Pending Entries List(PEL)**에 남게 됩니다. PEL을 주기적으로 모니터링하여 처리되지 않은 메시지를 재처리할 수 있습니다.

2. 메시지 재처리 및 클레임(Claim) 메커니즘

   - XCLAIM 명령어를 사용하여 일정 시간 동안 승인되지 않은 메시지를 다른 소비자에게 클레임할 수 있습니다. 이를 통해 장애로 인해 메시지 처리가 중단된 경우에도 메시지가 유실되지 않고 재처리될 수 있습니다.
   - PEL을 주기적으로 검사하여 장기간 처리되지 않은 메시지를 식별하고, 적절한 소비자가 다시 처리하도록 합니다.

3. Dead-Letter Queue(DLQ) 설정

   - Dead-Letter Queue를 별도의 스트림으로 설정하여 반복적으로 실패하는 메시지를 별도로 관리합니다. 이를 통해 장애 원인을 분석하고, 문제 있는 메시지를 별도로 처리할 수 있습니다.
   - 예를 들어, 특정 횟수 이상 처리에 실패한 메시지를 DLQ로 이동시켜 이후 수동으로 검토하고 수정할 수 있습니다.

4. 메시지 영속성 및 데이터 백업

   - Redis Streams는 디스크에 데이터를 영속화할 수 있으므로, RDB 또는 AOF(Append Only File) 설정을 통해 데이터의 내구성을 보장합니다.
   - 정기적인 데이터 백업을 수행하여 장애 발생 시 데이터를 복구할 수 있도록 합니다.

5. 적절한 메시지 처리 로직 구현

   - 메시지 처리 로직에서 예외 처리를 철저히 하여 예기치 않은 오류로 인한 메시지 손실을 방지합니다.
   - Idempotent(멱등성)한 메시지 처리를 구현하여 동일한 메시지가 여러 번 처리되더라도 시스템의 일관성을 유지하도록 합니다.

